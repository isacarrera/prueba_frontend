<ion-content class="zones-content" [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" pullingText="Arrastra para recargar"
      refreshingSpinner="circles" refreshingText="Recargando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="wrap">
    <ion-button class="back-button" fill="clear" (click)="goBack()">
      <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
    </ion-button>

    <div class="icon-header">
      <div class="icon-circle">
        <img src="../../../assets/images/heroicons_map-pin.png" alt="Ubicación" />
      </div>
      <h1 class="title">Zonas Operativas</h1>
    </div>

    <ion-searchbar placeholder="Buscar zona..." [(ngModel)]="searchTerm" debounce="300" class="custom-search">
    </ion-searchbar>

    <!-- Estado de carga -->
    <div *ngIf="cargando" class="loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando zonas...</p>
    </div>

    <!-- Grid de zonas -->
    <div class="zones-grid" *ngIf="!cargando">
      <div class="card-zona"
           *ngFor="let zona of filteredZonas()"
           [class.disabled]="!zona.isAvailable"
           (click)="zona.isAvailable && goToOperativo(zona.id)">

        <div class="card-info">
          <span class="label">{{ zona.name }}</span>

          <!-- Badge dinámico según estado -->
          <span class="badge" [ngClass]="{
            'badge-disponible': zona.stateZone === 1,
            'badge-inventario': zona.stateZone === 2,
            'badge-verificacion': zona.stateZone === 3
          }">
            {{ zona.stateLabel }}
          </span>
        </div>

        <!-- Icono dinámico según estado -->
        <div class="icon-circle-big" [ngClass]="{
          'free': zona.stateZone === 1,
          'inventory': zona.stateZone === 2,
          'verification': zona.stateZone === 3
        }">
          <ion-icon [name]="zona.iconName"></ion-icon>
        </div>

      </div>
    </div>

    <!-- Estado vacío -->
    <div *ngIf="!cargando && filteredZonas().length === 0" class="empty-state">
      <div class="empty-icon">
        <ion-icon name="map-outline"></ion-icon>
      </div>
      <h3>No se encontraron zonas</h3>
      <p *ngIf="searchTerm">
        No hay resultados para "{{ searchTerm }}"
      </p>
      <p *ngIf="!searchTerm">
        No hay zonas operativas disponibles.
      </p>
    </div>
  </div>
</ion-content>
