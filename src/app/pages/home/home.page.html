<ion-content class="zones-content" [fullscreen]="true">

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" pullingText="Arrastra para recargar"
      refreshingSpinner="circles" refreshingText="Recargando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="wrap">
    <ion-button class="back-button" fill="clear" (click)="goBack()">
      <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
    </ion-button>

    <div class="icon-header">
      <div class="icon-circle">
        <img src="../../../assets/images/heroicons_map-pin.png" alt="Ubicación" />
      </div>
      <h1 class="title">Zonas Operativas</h1>
    </div>

    <!-- Botón Unirse (reemplaza la barra de búsqueda) -->
    <div class="join-button-container">
      <button class="join-button" (click)="presentJoinPrompt()">
        <ion-icon name="add-outline"  class="join-icon"></ion-icon>
        <span class="join-text">Unirse</span>
      </button>
    </div>

    <!-- Barra espaciadora -->
    <div class="separator"></div>

    <div class="filters-container">
      <div class="filters-scroll">
        <button *ngFor="let filter of filters" class="filter-button" [class.active]="filter.active"
          (click)="setFilter(filter)">
          <ion-icon [name]="filter.icon"></ion-icon>
          <span>{{ filter.name }}</span>
        </button>
      </div>

      <!-- Botón para limpiar filtros (solo visible cuando hay filtros activos) -->
      <button *ngIf="activeFilter !== null || searchTerm" class="clear-filters-btn" (click)="clearFilters()">
        <ion-icon name="close-circle-outline"></ion-icon>
        Limpiar
      </button>
    </div>

    <!-- Estado de carga -->
    <div *ngIf="cargando" class="loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando zonas...</p>
    </div>

    <!-- Grid de zonas -->
    <div class="zones-grid" *ngIf="!cargando">
      <div class="card-zona" *ngFor="let zona of filteredZonas()" [class.disabled]="!zona.isAvailable"
        (click)="zona.isAvailable && goToOperativo(zona.id, zona.name)">

        <div class="card-info">
          <span class="label">{{ zona.name }}</span>
          <span class="badge" [ngClass]="{
            'badge-disponible': zona.stateZone === 1,
            'badge-inventario': zona.stateZone === 2,
            'badge-verificacion': zona.stateZone === 3
          }">
            {{ zona.stateLabel }}
          </span>
        </div>

        <div class="icon-circle-big" [ngClass]="{
          'free': zona.stateZone === 1,
          'inventory': zona.stateZone === 2,
          'verification': zona.stateZone === 3
        }">
          <ion-icon [name]="zona.iconName"></ion-icon>
        </div>
      </div>
    </div>

    <!-- Estado vacío -->
    <div *ngIf="!cargando && filteredZonas().length === 0" class="empty-state">
      <div class="empty-icon">
        <ion-icon name="map-outline"></ion-icon>
      </div>
      <h3>No se encontraron zonas</h3>
      <p *ngIf="searchTerm || activeFilter !== null">
        No hay resultados para los filtros aplicados.
      </p>
      <p *ngIf="!searchTerm && activeFilter === null">
        No hay zonas operativas disponibles.
      </p>
      <button *ngIf="searchTerm || activeFilter !== null" class="clear-filters-empty-btn" (click)="clearFilters()">
        Limpiar filtros
      </button>
    </div>
  </div>
</ion-content>
