<ion-content class="ion-padding">
  <div class="center-wrapper">
    
    <div *ngIf="!showFeedbackView" class="modal-wrapper">
      <header class="modal-header">
        <h2>Estado del Ã­tem</h2>
        <span class="item-code">{{ code }}</span>
        <button class="close-button" (click)="dismiss()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </header>

      <ion-list class="state-list">
        <ion-item
          *ngFor="let state of stateItems"
          class="state-item"
          [class.selected]="selectedStateId === state.id"
          (click)="selectedStateId = state.id"
        >
          <ion-label>
            <h3>{{ state.name }}</h3>
          </ion-label>
          <ion-icon
            *ngIf="selectedStateId === state.id"
            name="checkmark-outline"
            color="success"
            slot="end"
          ></ion-icon>
        </ion-item>
      </ion-list>

      <ion-button
        expand="block"
        color="primary"
        class="confirm-button"
        (click)="confirm()"
        [disabled]="!selectedStateId || isProcessing"
      >
        <ion-spinner *ngIf="isProcessing" name="crescent" slot="start"></ion-spinner>
        <ion-icon *ngIf="!isProcessing" name="checkmark-done-outline" slot="start"></ion-icon>
        Confirmar Estado
      </ion-button>
    </div>

    <div *ngIf="showFeedbackView" class="modal-wrapper feedback-view">
      
      <div class="feedback-icon" [ngClass]="'status-' + feedbackStatus">
        <ion-icon *ngIf="feedbackStatus === 'success'" name="checkmark-circle-outline"></ion-icon>
        <ion-icon *ngIf="feedbackStatus === 'error'" name="close-circle-outline"></ion-icon>
        <ion-icon *ngIf="feedbackStatus === 'warning'" name="warning-outline"></ion-icon>
        <ion-icon *ngIf="feedbackStatus === 'info'" name="information-circle-outline"></ion-icon>
      </div>
      
      <h2 class="feedback-title">Resultado</h2>
      <p class="feedback-message">{{ feedbackMessage }}</p>
      
      <ion-button (click)="closeModalAndContinue()" class="confirm-button">
        OK
      </ion-button>

    </div>

  </div>
</ion-content>